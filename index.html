<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Family Hub</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">

<div id="tab-add">
  <h1 class="text-xl font-bold">ğŸ’° Xarajat</h1>
  <input id="amount" type="number" placeholder="Summa" class="w-full p-3 border rounded-xl mt-3">
  <input id="cat" type="text" placeholder="Nima?" class="w-full p-3 border rounded-xl mt-3">
  <button onclick="addExpense()" class="w-full mt-4 p-4 bg-blue-500 text-white rounded-xl">
    Qoâ€˜shish
  </button>
</div>

<div id="tab-stats" class="hidden mt-6">
  <h1 class="text-xl font-bold">ğŸ“Š Oila statistikasi</h1>
  <ul id="list" class="mt-4 space-y-2 text-sm"></ul>
</div>

<div class="fixed bottom-0 left-0 w-full flex bg-white border-t">
  <button onclick="show('add')" class="w-1/2 p-3">â•</button>
  <button onclick="show('stats')" class="w-1/2 p-3">ğŸ“Š</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

const API = "https://asik.windowsnoutbook.workers.dev";
const user = tg.initDataUnsafe.user;

function show(t) {
  tab-add.classList.add("hidden");
  tab-stats.classList.add("hidden");
  document.getElementById("tab-"+t).classList.remove("hidden");
  if (t === "stats") loadStats();
}

async function addExpense() {
  await fetch(API+"/api/add", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      userId:user.id,
      userName:user.first_name,
      amount:amount.value,
      cat:cat.value
    })
  });
  amount.value=""; cat.value="";
  tg.showAlert("Saqlandi âœ…");
}

async function loadStats() {
  const r = await fetch(API+"/api/stats", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ userId:user.id })
  });
  const d = await r.json();
  d.sort((a,b)=>b.id-a.id);
  list.innerHTML = d.map(x =>
    `<li class="flex justify-between border-b">
      <span>${x.cat} <small>(${x.name})</small></span>
      <b>${x.amount}</b>
    </li>`
  ).join("");
}
</script>
</body>
</html>
