<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistika</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
  background: var(--tg-theme-bg-color,#fff);
  color: var(--tg-theme-text-color,#000);
}
.btn-primary{
  background: var(--tg-theme-button-color,#3390ec);
  color: var(--tg-theme-button-text-color,#fff);
}
</style>
</head>

<body class="p-4 select-none">

<h1 class="text-2xl font-bold text-center mb-3">Family Hub</h1>

<div class="space-y-3">

<!-- ADD EXPENSE -->
<div>
  <h2 class="font-bold">‚ûï Xarajat qo‚Äòshish</h2>

  <input id="amount" type="number" class="w-full p-2 border rounded" placeholder="Summa">
  <input id="cat" type="text" class="w-full p-2 border rounded mt-1" placeholder="Nima?">

  <button onclick="addExpense()" class="btn-primary w-full p-2 rounded mt-1">Qo‚Äòshish</button>
</div>

<!-- SEND MESSAGE -->
<div>
  <h2 class="font-bold">‚úâÔ∏è Oilaga xabar yuborish</h2>

  <textarea id="msg" class="w-full p-2 border rounded" rows="3"></textarea>

  <button onclick="sendMessage()" class="btn-primary w-full p-2 rounded mt-1">Yuborish</button>
</div>

<!-- CONNECT -->
<div>
  <h2 class="font-bold">üîó Oilani ulash</h2>

  <input id="connectId" type="number" class="w-full p-2 border rounded" placeholder="Masalan: 123456">

  <button onclick="connectFamily()" class="btn-primary w-full p-2 rounded mt-1">Ulanish</button>
</div>

<!-- UNC -->
<div>
  <h2 class="font-bold">üö™ Oiladan chiqish</h2>

  <button onclick="leaveFamily()" class="btn-primary w-full p-2 rounded">Chiqish</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const API_URL = "https://asik.windowsnoutbook.workers.dev"; // ALMASHTIR
const user = tg.initDataUnsafe.user || { id:"test", first_name:"Test" };

// ADD EXPENSE
async function addExpense(){
  await api("/api/add",{
    userId:user.id,
    userName:user.first_name,
    amount:document.getElementById("amount").value,
    cat:document.getElementById("cat").value
  });
  tg.showAlert("Qo‚Äòshildi");
}

// SEND
async function sendMessage(){
  await api("/api/send",{
    userId:user.id,
    userName:user.first_name,
    text:document.getElementById("msg").value
  });
  tg.showAlert("Yuborildi");
}

// CONNECT
async function connectFamily(){
  await api("/api/connect",{
    userId:user.id,
    userName:user.first_name,
    targetId:document.getElementById("connectId").value
  });
  tg.showAlert("So‚Äòrov yuborildi");
}

// UNC
async function leaveFamily(){
  await api("/api/unc",{ userId:user.id });
  tg.showAlert("Chiqding");
}

// ---- API helper
async function api(path,data){
  return fetch(API_URL+path,{
    method:"POST",
    headers:{ "Content-Type":"application/json"},
    body:JSON.stringify(data)
  });
}
</script>

</body>
</html>
